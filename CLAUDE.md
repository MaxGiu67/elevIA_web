# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

UPGRAI is a documentation and specification repository for an **Agentic Website Framework** - a modular architecture for building AI-powered websites that combine traditional SEO with conversational AI capabilities (RAG chat, dynamic page personalization, lead generation).

This is currently a **specification/design phase repository** containing technical guides in Italian. No runnable code exists yet - the documents define how to build the system.

## Key Documents

- `Analisi_Funzionale_Framework_Agentic_Website.md` - Functional analysis defining requirements, architecture layers, and core components
- `Backend_Python_LangChain_LangGraph_Guida_Tecnica.md` - Backend implementation guide (Python/FastAPI/LangChain/LangGraph)
- `Frontend_NextJS_PagePlan_Guida_Tecnica.md` - Frontend implementation guide (Next.js 14+, SSG/SSR, Page Plan system)
- `analisi_framework_siti_agentici.md` - High-level technical analysis and roadmap

## Architecture Summary

The framework follows a layered architecture:

```
┌─────────────────────────────────────────────────────────────┐
│  Presentation Layer (Next.js)                               │
│  - SSG/SSR pages from Markdown content                      │
│  - Chat widget with streaming                               │
│  - Page Plan: dynamic client-side page personalization      │
├─────────────────────────────────────────────────────────────┤
│  Agent Layer (LangGraph)                                    │
│  - Agent Orchestrator, Context Manager                      │
│  - Nodes: detect_language, classify_intent, retrieve_docs,  │
│           generate_answer, page_plan, lead_trigger          │
├─────────────────────────────────────────────────────────────┤
│  Intelligence Layer (LangChain)                             │
│  - RAG Engine (ingestion, chunking, retrieval)              │
│  - LLM Gateway (multi-provider: OpenAI, Anthropic, Google)  │
├─────────────────────────────────────────────────────────────┤
│  Services Layer                                             │
│  - Content Service (Markdown with front-matter)             │
│  - Vector Store (Chroma/FAISS)                              │
│  - Lead Service, Analytics                                  │
├─────────────────────────────────────────────────────────────┤
│  Data Layer                                                 │
│  - Markdown files (content/it/, content/en/)                │
│  - Vector DB, PostgreSQL, Redis                             │
└─────────────────────────────────────────────────────────────┘
```

## Planned Tech Stack

**Backend (apps/api/)**
- Python 3.11+
- FastAPI for REST API
- LangChain + LangGraph for AI orchestration
- ChromaDB or FAISS for vector storage
- Pydantic for validation

**Frontend (apps/web/)**
- Next.js 14+ with App Router
- React 18+
- TypeScript
- Tailwind CSS
- Zustand for state management

**Content**
- Markdown files with YAML front-matter
- Bilingual support: IT/EN
- Structure: `content/{lang}/pages|articles|faq/*.md`

## Key Concepts

### Page Plan
A JSON structure generated by the AI agent to dynamically personalize page layout based on user intent, while preserving SEO-stable canonical URLs. The frontend applies Page Plan changes client-side.

### RAG Pipeline
1. Content ingestion: Markdown → chunks (heading-based)
2. Embedding generation → Vector store
3. Retrieval with language/content-type filters
4. LLM generation with grounded responses + source citations

### Multi-language
- URL structure: `/it/...` and `/en/...`
- Front-matter `alternate` field for hreflang
- Language detection in chat API

## Implementation Phases (from roadmap)

- **Phase 0-1**: Foundation - project skeleton, content structure, basic page rendering
- **Phase 2**: RAG Chat MVP - ingestion pipeline, `/api/chat` with streaming
- **Phase 3**: Agentic features - intent classification, lead triggers, Page Plan
- **Phase 4**: AI discoverability - llms.txt, public JSON endpoints

## Content Front-matter Schema

```yaml
id: unique-content-id
type: page|article|faq
lang: it|en
title: "Page Title"
description: "SEO description"
slug: "url-slug"
canonical: "/it/path/to/page"
alternate:
  en: "/en/path/to/page"
tags: ["tag1", "tag2"]
published_at: "2026-01-10"
updated_at: "2026-01-20"
draft: false
```

## When Implementing

- Maintain SEO-first approach: stable canonical URLs, SSG/SSR rendering
- AI personalization is "on top" of static content, never replaces it for crawlers
- Use graceful degradation: site must work fully if AI services are down
- Implement provider abstraction for LLMs to support multiple backends
- Apply rate limiting and prompt injection protection on chat endpoints
